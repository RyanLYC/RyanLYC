### 前端监控

#### 为什么要前端监控

- 页面的访问行为 - PV、UV、IP、PV 点击率、UV 点击率
- 用户操作行为 - 模块曝光（显示）、模块点击、滑动等操作
- 页面性能，首屏渲染时间，API 请求时间
- 异常的监控，JS Error，API 异常、业务异常
- 业务的监控数据。（前端上报，依靠后端统计）

#### 应用场景

- 流量分析
- 行为分析
- 性能监控
- 异常监控

#### 前端监控平台有哪些

- 百度统计
- 阿里云 ARMS
- 友盟 - APP 监控
  `流量统计和分析免费,行为分析需要付费`

#### 为什么需要自建

- 数据掌握在自己手里做分析。其他平台数据只能看
- 希望更多的分析纬度和能力

#### 前端监控平台架构设计

##### 监控平台分层

- 前端监控 JS-SDK
  - 采集
  - 上报
    - 默认上报：页面 PV、性能
    - 手动上报：页面操作行为
- 前端监控 API 和大数据仓库
  - 接收上报的数据
  - 数据仓库：MaxCompute
    - 数据存储
    - 数据查询
- 前端监控数据的可视化

  - 日志大数据清洗
  - 大数据回流（非结构化数据 => 结构化数据）
  - 对结构化进行运算生成图表

![前端监控平台架构](./assets/前端监控平台架构.png)

#### 浏览器的 5 种 Observer

- IntersectionObserver 用于观察一个元素是否在视窗可见.构造函数创建并返回一个新的 IntersectionObserver 对象，一般用于无限滚动,图片懒加载,埋点,控制动画/视频执行
- MutationObserver 是异步触发,DOM 的变动并不会马上触发,而是要等到当前所有 DOM`操作都结束才触发，可以通过配置项,监听目标 DOM 下子元素的变更记录。一般用于更高性能的数据绑定及响应
- PerformanceObserver 用于监测性能度量事件,在浏览器的性能时间轴记录下一个新的 performance entries 的时候将会被通知，用途:更细颗粒的性能监控.
- ResizeObserver 构造器创新一个新的 ResizeObserver 对象,用于接收 Element 内容区域的改变或 SVGElement 的边界框改变改变，用途:更智能的响应式布局(取代@media)以及响应式组件
- ReportingObserver 构造函数会创建一个新的 ReportingObserver 对象实,该实例可用于收集和获取 reports，使用:将浏览器弃用的 API 或者运行时浏览器的干预行为由自己约束
